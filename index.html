<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sync Game - 2 Joueurs</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        .container { width: 100%; max-width: 500px; }
        .box { background: #1e293b; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        
        /* Zone de connexion */
        #setup-box { border: 2px dashed #334155; }
        .id-display { font-size: 1.2rem; color: #f472b6; background: #020617; padding: 10px; border-radius: 8px; display: inline-block; margin: 10px 0; }

        /* Zone de chat/jeu */
        #chat { height: 350px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 10px; border: 1px solid #334155; border-radius: 10px; background: #020617; margin-bottom: 15px; }
        .msg { padding: 10px 14px; border-radius: 15px; max-width: 85%; line-height: 1.4; }
        .msg.me { align-self: flex-end; background: #3b82f6; color: white; border-bottom-right-radius: 2px; }
        .msg.friend { align-self: flex-start; background: #334155; color: #f472b6; border: 1px solid #f472b6; border-bottom-left-radius: 2px; }
        
        input { width: calc(100% - 24px); padding: 12px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; margin-bottom: 10px; }
        button { width: 100%; padding: 12px; border-radius: 8px; border: none; background: #f472b6; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #db2777; filter: brightness(1.1); }
        
        #victory { display: none; color: #4ade80; font-size: 1.8rem; text-align: center; font-weight: bold; margin: 10px 0; animation: bounce 0.6s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }
    </style>
</head>
<body>

    <div class="container">
        <h1 style="text-align: center;">ðŸš€ Sync Game</h1>

        <div id="setup-box" class="box">
            <p>1. Partage ton ID Ã  ton ami :</p>
            <div id="my-id" class="id-display">Chargement...</div>
            <p>2. OU colle l'ID de ton ami ici :</p>
            <input type="text" id="join-id" placeholder="Code de l'ami...">
            <button onclick="connecter()">LANCER LA PARTIE</button>
        </div>

        <div id="game-box" class="box" style="display: none;">
            <div id="chat"></div>
            <div id="victory">âœ¨ SYNCHRO ! âœ¨</div>
            <input type="text" id="word-input" placeholder="Tape un indice ou un nom...">
            <button onclick="envoyerMot()">ENVOYER</button>
            <button onclick="location.reload()" style="background: #475569; margin-top: 20px; font-size: 0.8rem;">Quitter / Relancer</button>
        </div>
    </div>

    <script>
        const peer = new Peer();
        let conn;
        let dernierMoi = "";
        let dernierAmi = "";

        peer.on('open', (id) => { document.getElementById('my-id').innerText = id; });

        // Cas oÃ¹ tu REÃ‡OIS la connexion
        peer.on('connection', (connection) => {
            conn = connection;
            configurerLien();
            demarrerInterfaceJeu();
        });

        // Cas oÃ¹ tu LANCE la connexion
        function connecter() {
            const targetId = document.getElementById('join-id').value.trim();
            if (!targetId) return alert("Il faut l'ID de ton ami !");
            
            conn = peer.connect(targetId);
            configurerLien();
            // On attend que la connexion soit ouverte pour changer l'Ã©cran
            conn.on('open', () => {
                demarrerInterfaceJeu();
            });
        }

        function configurerLien() {
            conn.on('data', (data) => {
                dernierAmi = data.toLowerCase().trim();
                ajouterAuChat(data, 'friend');
                verifierVictoire();
            });
        }

        function demarrerInterfaceJeu() {
            // C'est ici que la magie opÃ¨re : on cache l'un et on montre l'autre
            document.getElementById('setup-box').style.display = "none";
            document.getElementById('game-box').style.display = "block";
        }

        function envoyerMot() {
            const input = document.getElementById('word-input');
            const mot = input.value.trim();
            if (!mot) return;

            dernierMoi = mot.toLowerCase().trim();
            conn.send(mot);
            ajouterAuChat(mot, 'me');
            input.value = "";
            verifierVictoire();
        }

        function ajouterAuChat(texte, auteur) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.classList.add('msg', auteur);
            div.innerText = texte;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function verifierVictoire() {
            if (dernierMoi === dernierAmi && dernierMoi !== "") {
                document.getElementById('victory').style.display = "block";
            } else {
                document.getElementById('victory').style.display = "none";
            }
        }
    </script>
</body>
</html>
